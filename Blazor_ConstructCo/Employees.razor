@page "/employees"
@using ConstructCo.Shared.Models.API
@rendermode InteractiveServer

<main class="container">
    <h2>Employees</h2>

    @if (String.IsNullOrEmpty(SuccessMessage) == false)
    {
        <div class="alert alert-success">@SuccessMessage</div>
    }

    <div class="form-check mb-3">
        <input class="form-check-input"
               type="checkbox"
               id="showManagers"
               @onchange="OnShowManagerChanged" />
        <label class="form-check-label" for="showManagers">
            Show Managers Only
        </label>
    </div>

    @if (Emps == null)
    {
        <p><em>Loading...</em></p>
    }
    else
    {
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-light">
                <tr>
                    <th>Emp#</th>
                    <th>Last Name</th>
                    <th>First Name</th>
                    <th>Initial</th>
                    <th>Hire Date</th>
                    <th>Job Code</th>
                    <th>Years</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (Employee emp in Emps)
                {
                    <tr>
                        <td>@emp.EmpNum</td>
                        <td><input class="form-control" @bind="@emp.EmpLname" /></td>
                        <td><input class="form-control" @bind="@emp.EmpFname" /></td>
                        <td><input class="form-control" maxlength="1" @bind="@emp.EmpInitial" /></td>
                        <td><input type="date" class="form-control" @bind-value="@emp.EmpHireDate" @bind-value:format="yyyy-MM-dd" /></td>
                        <td><input type="number" class="form-control" @bind="@emp.JobCode" /></td>
                        <td><input type="number" class="form-control" min="0" max="255" @bind="@emp.EmpYears" /></td>
                        <td class="d-flex justify-content-end gap-2">
                            <button class="btn btn-sm btn-primary" @onclick="() => SaveEmployee(emp)">Save</button>
                            <button class="btn btn-sm btn-danger" @onclick="() => DeleteEmployee(emp.EmpNum)">Delete</button>
                        </td>
                    </tr>
                }

                <!-- Create new employee row -->
                <tr class="table-success" id="create-employee-row">
                    <td><span class="text-muted">Auto</span></td>
                    <td><input class="form-control" @bind="NewEmployee.EmpLname" placeholder="Last Name" /></td>
                    <td><input class="form-control" @bind="NewEmployee.EmpFname" placeholder="First Name" /></td>
                    <td><input class="form-control" maxlength="1" @bind="NewEmployee.EmpInitial" placeholder="M" /></td>
                    <td><input type="date" class="form-control" @bind-value="NewEmployee.EmpHireDate" @bind-value:format="yyyy-MM-dd" /></td>
                    <td><input type="number" class="form-control" min="0" placeholder="100" @bind="NewEmployee.JobCode" /></td>
                    <td><input type="number" class="form-control" min="0" max="255" @bind="NewEmployee.EmpYears" /></td>
                    <td class="text-end">
                        <button class="btn btn-sm btn-success" @onclick="CreateEmployee">Create</button>
                    </td>
                </tr>
            </tbody>
        </table>
    }
</main>
